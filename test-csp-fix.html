<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSP Fix Test - Cyft</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success {
            color: green;
        }
        .error {
            color: red;
        }
        #log {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>CSP Fix Test Page</h1>
    
    <div class="test-section">
        <h2>Test 1: Inline Script</h2>
        <p id="inline-test">Testing inline script execution...</p>
    </div>

    <div class="test-section">
        <h2>Test 2: External Module</h2>
        <p id="module-test">Testing module script execution...</p>
    </div>

    <div class="test-section">
        <h2>Test 3: Dynamic Script Creation</h2>
        <p id="dynamic-test">Testing dynamic script creation...</p>
    </div>

    <div class="test-section">
        <h2>Test 4: Event Handlers</h2>
        <button onclick="handleClick()">Click Me</button>
        <p id="event-test">Testing event handlers...</p>
    </div>

    <div class="test-section">
        <h2>Console Log</h2>
        <div id="log"></div>
    </div>

    <script>
        // Inline script test
        document.getElementById('inline-test').innerHTML = '<span class="success">✓ Inline script executed successfully!</span>';
        
        // Log function
        function log(message) {
            const logDiv = document.getElementById('log');
            logDiv.textContent += `[${new Date().toLocaleTimeString()}] ${message}\n`;
        }
        
        log('Page loaded');
        log('Inline script executed');
        
        // Event handler test
        function handleClick() {
            document.getElementById('event-test').innerHTML = '<span class="success">✓ Event handler executed successfully!</span>';
            log('Button clicked - event handler executed');
        }
        
        // Dynamic script test
        try {
            const dynamicScript = document.createElement('script');
            dynamicScript.textContent = `
                document.getElementById('dynamic-test').innerHTML = '<span class="success">✓ Dynamic script executed successfully!</span>';
                log('Dynamic script executed');
            `;
            document.body.appendChild(dynamicScript);
        } catch (e) {
            document.getElementById('dynamic-test').innerHTML = '<span class="error">✗ Dynamic script failed: ' + e.message + '</span>';
            log('Dynamic script error: ' + e.message);
        }
        
        // Check for CSP violations
        document.addEventListener('securitypolicyviolation', (e) => {
            log(`CSP Violation: ${e.violatedDirective} - ${e.blockedURI}`);
        });
    </script>

    <script type="module">
        // Module script test
        document.getElementById('module-test').innerHTML = '<span class="success">✓ Module script executed successfully!</span>';
        
        // Test import.meta
        try {
            if (import.meta) {
                window.log('import.meta is available');
                if (import.meta.env) {
                    window.log('import.meta.env is available');
                } else {
                    window.log('import.meta.env is undefined');
                }
            }
        } catch (e) {
            window.log('Error accessing import.meta: ' + e.message);
        }
        
        // Test dynamic import
        try {
            const testModule = await import('./src/js/modules/logger.js');
            window.log('Dynamic import successful');
        } catch (e) {
            window.log('Dynamic import failed: ' + e.message);
        }
    </script>
</body>
</html> 