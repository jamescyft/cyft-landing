<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CSP Debug Test</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .test { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .pass { background: #d4edda; }
        .fail { background: #f8d7da; }
    </style>
</head>
<body>
    <h1>CSP Debug Test Page</h1>
    
    <div id="tests"></div>
    
    <script>
        const tests = [];
        const addTest = (name, fn) => {
            try {
                fn();
                tests.push({ name, status: 'PASS' });
            } catch (e) {
                tests.push({ name, status: 'FAIL', error: e.message });
            }
        };
        
        // Test 1: Inline script execution
        addTest('Inline Script', () => {
            console.log('Inline script executed');
        });
        
        // Test 2: eval()
        addTest('eval()', () => {
            eval('1 + 1');
        });
        
        // Test 3: new Function()
        addTest('new Function()', () => {
            new Function('return 1')();
        });
        
        // Test 4: setTimeout with string
        addTest('setTimeout string', () => {
            setTimeout('console.log("test")', 0);
        });
        
        // Test 5: Data URI
        addTest('Data URI Image', () => {
            const img = new Image();
            img.src = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==';
        });
        
        // Test 6: Blob URL
        addTest('Blob URL', () => {
            const blob = new Blob(['test'], { type: 'text/plain' });
            URL.createObjectURL(blob);
        });
        
        // Display results
        const container = document.getElementById('tests');
        tests.forEach(test => {
            const div = document.createElement('div');
            div.className = `test ${test.status === 'PASS' ? 'pass' : 'fail'}`;
            div.innerHTML = `
                <strong>${test.name}:</strong> ${test.status}
                ${test.error ? `<br>Error: ${test.error}` : ''}
            `;
            container.appendChild(div);
        });
        
        // Log CSP violations
        document.addEventListener('securitypolicyviolation', (e) => {
            console.error('CSP Violation:', {
                blockedURI: e.blockedURI,
                violatedDirective: e.violatedDirective,
                originalPolicy: e.originalPolicy
            });
        });
    </script>
    
    <!-- Test external script -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
</body>
</html> 